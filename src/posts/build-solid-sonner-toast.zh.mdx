---
title: ä½¿ç”¨ Solid.js å®ç° sonner
date: 2024-02-25
description: è®°å½•ä½¿ç”¨ Solid.js å®ç° sooner çš„è¿‡ç¨‹
---

[sonner](https://sonner.emilkowal.ski/) æ˜¯ä¸€ä¸ªä¼˜ç§€çš„ toast ç»„ä»¶ï¼Œæƒ³äº†è§£å…¶å®ç°çš„æœ€å¥½æ–¹æ³•å°±æ˜¯åŠ¨æ‰‹è‡ªå·±å®ç°ä¸€éï¼Œä½†æ˜¯é‡å¤ä½¿ç”¨ React å®ç°æœªå…å¤ªè¿‡æ¯ç‡¥

æ‰€ä»¥æˆ‘é€‰æ‹©äº†ä½¿ç”¨ Solid.jsï¼Œå°½ç®¡ Github ä¸Šå·²ç»å­˜åœ¨äº†[solid-sonner](https://github.com/wobsoriano/solid-sonner)ï¼Œä½†ä»åœ¨å®ç°çš„è¿‡ç¨‹ä¸­å­¦åˆ°äº†ä¸€äº›ä¸œè¥¿ï¼Œä½ å¯ä»¥åœ¨è¿™é‡Œè®¿é—® [æ–‡æ¡£](https://solid-sonner-toast-website.vercel.app/docs/getting-started) ä¸ [æºç ]((https://github.com/Ken-HH24/solid-sonner-toast))

## çŠ¶æ€ç®¡ç†

[sonner](https://sonner.emilkowal.ski/) å®˜æ–¹ä½¿ç”¨äº† **Observer Pattern** å»ç®¡ç† `toasts` çš„çŠ¶æ€ï¼Œåœ¨ React Component é‡Œé€šè¿‡ useEffect å»è®¢é˜…å˜åŒ–å¹¶æ›´æ–°è§†å›¾

ä½†æ˜¯å¯¹äº Solid.jsï¼Œåˆ©ç”¨ fine grained reactivityï¼Œå¯ä»¥ç›´æ¥å¤–éƒ¨çš„ä»»æ„åœ°æ–¹ä½¿ç”¨ `createStore()` å»ç®¡ç† toasts çš„çŠ¶æ€

åªéœ€ `toast()` å‡½æ•°è¢«æ‰§è¡Œæ—¶ï¼Œé€šè¿‡ `setToasts()` å³å¯é©±åŠ¨è§†å›¾çš„æ›´æ–°å³å¯

```ts
class ToastState {
  toasts: ToastT[]
  setToasts: SetStoreFunction<ToastT[]>

  constructor() {
    const [toasts, setToasts] = createStore<ToastT[]>([])
    this.toasts = toasts
    this.setToasts = setToasts
  }

  addToast = (toast: ToastT) => {
    this.setToasts(
      produce((toasts) => {
        toasts.unshift(toast)
      }),
    )
  }

  createToast = (data: ExternalToast & { message?: string | JSXElement }) => {
    // ... ...
  }

  message = (message: string | JSXElement, data?: ExternalToast) => {
    this.createToast({ ...data, message })
  }

  // ... ...
}
```

## Reactivity

Solid.js å’Œ React çš„ä¸åŒä¸»è¦åœ¨äº Solid.js ä»…æ‰§è¡Œä¸€æ¬¡ç»„ä»¶å‡½æ•°

æ‰€ä»¥å¦‚æœæƒ³å˜é‡æ˜¯å“åº”å¼çš„ï¼Œéœ€è¦é¢å¤–ä½¿ç”¨å‡½æ•°åŒ…è£¹ï¼ŒSolid.js æ‰ä¼šå°†å˜åŒ–æ›´æ–°åˆ°è§†å›¾

æ¯”å¦‚åœ¨å‡½æ•°å†…å°† `props.position.split("-")` èµ‹å€¼ç»™ `coords` å˜é‡ï¼Œç„¶ååœ¨æ¸²æŸ“æ—¶ä½¿ç”¨ï¼Œè¯¥å˜é‡å¹¶ä¸ä¼šè·Ÿéš `props.position` çš„æ”¹å˜

```tsx
const Toaster = (props) => {
  const coords = props.position.split('-')

  // won't change with props.position
  return <div>{coords[0]}</div>
}
```

éœ€è¦é¢å¤–ä½¿ç”¨ç®­å¤´å‡½æ•°åŒ…è£¹ï¼Œç„¶ååœ¨ UI é‡Œæ‰§è¡Œï¼ŒSolid.js æ‰çŸ¥é“å®ƒæ˜¯å“åº”å¼çš„

```tsx
const Toaster = (props) => {
  const coords = () => props.position.split('-')

  // update when props.position changes
  return <div>{coords()[0]}</div>
}
```

## åŠ¨ç”»

[sonner](https://sonner.emilkowal.ski/) åˆ©ç”¨ csså˜é‡ ä»¥åŠ `data-*` å°†åŠ¨ç”»æ‹†åˆ†æˆäº†å››æ­¥

1. åˆå§‹ï¼š`opacity=0` && `translateY(100%)`ï¼Œæ­¤æ—¶ `toast` ä¸å¯è§ï¼Œæ‰§è¡Œè¿›åœºåŠ¨ç”»
2. æŒ‚è½½ï¼š`opacity=1` and `translateY(0)`ï¼Œæ­¤æ—¶ `toast` æ˜¾ç¤ºåˆ°å¯¹åº”ä½ç½®
3. ç§»é™¤ï¼š`opacity=0` and `translateY(100%)`ï¼Œæ­¤æ—¶ `toast` è¢«æ ‡è®°ç§»é™¤ï¼Œæ‰§è¡ŒåŠ¨ç”»
4. å¸è½½ï¼š`toast` å¯¹åº”çš„ DOM å…ƒç´ è¢«å¸è½½

åœ¨å®ç°è¿‡ç¨‹ä¸­è¸©çš„ä¸€ä¸ªå‘æ˜¯éœ€è¦æ³¨æ„ `data-*={variable}` ä¸­çš„ `variable` æ˜¯å¦ä¸º undefinedï¼Œæœ€å¥½ä½¿ç”¨ `Boolean()` è§„é¿è¿™ä¸ªé—®é¢˜

```tsx
<div
  // use Boolean to avoid undefined
  data-expanded={Boolean(props.expanded)}
/>
```

## JSX

å½“æˆ‘ç¬¬ä¸€æ¬¡å®ç°çš„æ—¶å€™ï¼Œå¾ˆè‡ªç„¶åœ°å†™ä¸‹ä»¥ä¸‹ä»£ç 

```tsx
const SuccessIcon = <svg>{/* ... ... */}</svg>

const Toast = () => {
  return <div>{SuccessIcon}</div>
}
```

ä½†æ˜¯å½“æœ‰å¤šä¸ª toast æ—¶ï¼Œä»…æœ‰ä¸€ä¸ª `<SuccessIcon />` æ­£å¸¸æ˜¾ç¤º

åœ¨ Solid.js çš„ playground å¯ä»¥çœ‹åˆ°è¢«ç¼–è¯‘ä¸ºä»¥ä¸‹ä»£ç 

```tsx {1,4,6}
import { template as _$template } from 'solid-js/web'
import { insert as _$insert } from 'solid-js/web'

const _tmpl$ = /*#__PURE__*/ _$template(`<svg />`),
  _tmpl$2 = /*#__PURE__*/ _$template(`<div>`)
const SuccessIcon = _tmpl$()

const Toast = () => {
  return (() => {
    const _el$2 = _tmpl$2()
    _$insert(_el$2, SuccessIcon)
    return _el$2
  })()
}
```

`<ScuuessIcon />` æ˜¯ä¸€ä¸ªè¢«åˆ›å»ºå¥½çš„å…ƒç´ ï¼Œå½“æœ‰å¤šä¸ª toast æ¸²æŸ“æ—¶ï¼ŒSolid.js ä½¿ç”¨ `document.appendChild()` å°†è¯¥å…ƒç´ é‡å¤æ¸²æŸ“åˆ°å¤šä¸ª `toast` ä¸Šï¼Œæœ€ç»ˆä»…æœ‰æœ€åä¸€ä¸ª `toast` å¾—åˆ°äº†æ‰€æœ‰æƒ

ä¿®å¤è¿™ä¸ªé—®é¢˜åˆ™æ˜¯å°† `SuccessIcon` æ”¹å†™ä¸ºå‡½æ•°çš„å½¢å¼ï¼Œè®© Solid.js æ¸²æŸ“ä¸åŒçš„å®ä¾‹

```tsx
const SuccessIcon = () => <svg>{/* ... ... */}</svg>
```

## å®˜ç½‘

Solid.js æ²¡æœ‰åƒ React ä¸€æ ·æœ‰å¾ˆå¤šå¼€ç®±å³ç”¨çš„å»ºç«™æ¡†æ¶ï¼ŒAstro é€šå¸¸æ˜¯ç¬¬ä¸€é€‰æ‹©ï¼Œä½†æ˜¯ä¹Ÿè®¸æ˜¯ä¸ºäº†æŠ˜è…¾ï¼Œæˆ‘ä½¿ç”¨äº† [SolidStart](https://start.solidjs.com/getting-started/what-is-solidstart) å»æ‰“é€ å®˜ç½‘

[SolidStart](https://start.solidjs.com/getting-started/what-is-solidstart) æ²¡æœ‰å¤ªå¤šå¤æ‚çš„æ¦‚å¿µï¼Œå…¶åº•å±‚ä½¿ç”¨äº† [Nitro](https://nitro.unjs.io/) ä½œä¸º Serverï¼ˆè¯¥æ¡†æ¶ä¹Ÿæ˜¯ [Nuxt](https://nuxt.com/) çš„ Serverï¼‰ï¼Œè¿™æ ·ä¹Ÿè¾¾åˆ°äº†ç”Ÿæ€å…±äº«çš„ç›®çš„

### MDX

SolidStart å·²ç»æä¾›äº†å¼€ç®±å³ç”¨çš„ **MDX** æ”¯æŒï¼Œåªéœ€è¦åœ¨ **routes** ç›®å½•ä¸‹ä¹¦å†™ `.mdx` å³å¯æ¸²æŸ“å†…å®¹

ä½†æˆ‘ä¸ªäººå…¶å®æ¯”è¾ƒå–œæ¬¢ [Contentlayer](https://contentlayer.dev/) ä¸ [Next.js](https://nextjs.org/) çš„ç»„åˆæ–¹å¼ï¼Œå³

1. åœ¨ contents ç›®å½•ä¸‹ä¹¦å†™æ–‡æ¡£
2. åˆ©ç”¨ Contentlayer ç”Ÿæˆå†…å®¹
3. åœ¨ [slug].tsx é‡Œæ‹¿åˆ°å¯¹åº”çš„å†…å®¹ï¼Œä½¿ç”¨ `useMDXComponent()` æ¸²æŸ“

ä½†å¾ˆå¯æƒœ Contentlayer å®˜æ–¹ä»…æä¾›äº†ä¸ [Next.js](https://nextjs.org/) çš„ç»“åˆæ–¹å¼ï¼Œå…¶ä»–æ¡†æ¶ä¾‹å¦‚ Vite éƒ½ä»åœ¨è®¡åˆ’ä¸­

#### [Contentlayer](https://contentlayer.dev/) ä¸ [mdx-bundler](https://github.com/kentcdodds/mdx-bundler)

å‚è€ƒ Contentlayer é‡Œ `useMDXComponent()` å’Œ mdx-bundler çš„æºç ï¼Œè¦è¾¾åˆ°ä¸Šè¿°æ•ˆæœï¼ŒäºŒè€…éƒ½åšäº†ä¸€ä¸‹äº‹æƒ…

1. å°† **MDX** æ–‡ä»¶ç¼–è¯‘ä¸º **iife** å½¢å¼çš„ä»£ç 
2. åœ¨ [slug].tsx é‡Œæ‹¿åˆ°å¯¹åº”æ–‡ç« çš„ä»£ç ï¼Œæ‰§è¡Œ `new Function()` å¾—åˆ°æ¸²æŸ“çš„ Component

```js title="mdx-bundler" {3}
function getMDXExport(code, globals) {
  const scope = { React, ReactDOM, _jsx_runtime, ...globals }
  const fn = new Function(...Object.keys(scope), code)
  return fn(...Object.values(scope))
}
```

#### åŸºäº rollup å®ç°

ç›®å‰æ€è·¯å·²ç»å¾ˆæ˜ç¡®äº†ï¼Œé‚£å°±æ˜¯ï¼š

1. åŸºäº rollup å®ç°æ‰“åŒ…ï¼ˆæœ€åˆæ˜¯ä½¿ç”¨ esbuildï¼Œä½†æ˜¯ä¸ Solid.js ç»“åˆçš„é…ç½®æ²¡æœ‰å¼„å‡ºæ¥ğŸ˜­ï¼‰ï¼Œæ¯ä¸ª mdx æ–‡ä»¶éƒ½åˆ†åˆ«ä½œä¸ºå…¥å£ï¼Œæœ€åè¾“å‡ºçš„æ˜¯ä¸ Contentlayer ç›¸ä¼¼çš„ json äº§ç‰©
2. ä½¿ç”¨ `@mdx-js/rollup` å’Œ `babel` å°† MDX ç¼–è¯‘ä¸º IIFEä»£ç  `return Component`
3. åœ¨ **renderChunk** é˜¶æ®µæ‹¿åˆ°æœ€åç¼–è¯‘å¥½çš„ä»£ç ï¼Œä½¿ç”¨ `this.emitFile()` è¾“å‡º json æ–‡ä»¶
4. åœ¨ **generateBundle** é˜¶æ®µå°† js æ–‡ä»¶ä» bundle é‡Œåˆ é™¤ï¼Œäº§ç‰©é‡Œæ— éœ€åŒ…å«

ç¬¬ä¸‰ä¸ç¬¬å››æ­¥æˆ‘åˆ†åˆ«å†™äº†ä¸¤ä¸ª rollup plugin å»å®ç°

```ts title="inject-mex-data" {10-17}
export const injectMDXData = () => {
  return {
    name: 'inject-mdx-data',
    renderChunk(code, chunk) {
      const moduleId = chunk.facadeModuleId || ''
      const moduleMeta = this.getModuleInfo(moduleId)?.meta
      const contentData = moduleMeta?.contentData || {}

      this.emitFile({
        type: 'asset',
        fileName: `${chunk.name}.json`,
        source: JSON.stringify({
          code,
          ...contentData,
        }),
      })
    },
  }
}
```

æœ€åçš„ `rollup.config.ts` ä¸º

```ts title="rollup.config.ts"
const rollupOptions = inputs.map(
  (input): RollupOptions => ({
    input: input.path,
    output: {
      dir: 'contents',
      name: 'Component',
      format: 'iife',
      footer: '; return Component',
    },
    plugins: [
      injectMDXData(),
      nodeResolve(),
      mdx({
        jsxImportSource: 'solid-jsx',
        jsx: true,
        // ... ...
      }),
      typescript(),
      babel({
        presets: ['solid'],
        babelHelpers: 'bundled',
        extensions: ['.js', '.jsx', '.cjs', '.mjs', '.md', '.mdx', '.tsx', 'ts'],
      }),
      renderMDXData(),
    ],
  }),
)
```

#### JSX äº¤ç”± babel ç¼–è¯‘

å®ç°çš„è¿‡ç¨‹å½“ç„¶ä¹Ÿä¸æ˜¯ä¸€å¸†é£é¡ºï¼Œä¾‹å¦‚ `@mdx-js/rollup` æ’ä»¶çš„ **jsx** é€‰é¡¹æ²¡æœ‰å¼€å¯ï¼Œè¿™ä¸ªæ—¶å€™ä¼šå¯¼è‡´ç¼–è¯‘å‡ºçš„ Solid.js ä»£ç å¤±å»å“åº”å¼

å¯ä»¥çœ‹åˆ°åœ¨ä¼ ç»™ `Tab` ç»„ä»¶çš„å¯¹è±¡é‡Œï¼Œchildren å‰éƒ½ç¼ºå°‘äº† **getter** ä¿®é¥°

```ts title="getting-startted.json" {3}
children: [d(Tab, {
          value: "pnpm",
          children: d(_components.figure, {
          // ... ...
          })})]
```

å½“æ’ä»¶å¼€å¯ **jsx** é€‰é¡¹åï¼Œjsx äº¤ç”±äº† babel ç¼–è¯‘ï¼Œåˆ©ç”¨ Solid.js çš„ preset å°†ç»„ä»¶ç¼–è¯‘ä¸ºå“åº”å¼

```ts title="rollup.config.ts" {3}
mdx({
  jsxImportSource: 'solid-jsx',
  jsx: true,
  // ... ...
}),
```

ç¼–è¯‘çš„ç»“æœä¸ºï¼š

```ts title="getting-startted.json" {3}
return [createComponent(Tab, {
          value: "pnpm",
          get children() {
          // ... ...
        }})]
```

#### Comp is not a function

é‡åˆ°çš„å¦å¤–ä¸€ä¸ªé—®é¢˜æ˜¯è¿è¡Œæ—¶æŠ¥é”™ **Comp is not a function**ï¼Œè§£å†³æ–¹æ³•æ˜¯åœ¨è§£å†³ä¸Šä¸€ä¸ªé—®é¢˜çš„åŒæ—¶æ— æ„å‘ç°çš„

åŸå› å°±æ˜¯ `createComponent()` æ¥æ”¶çš„éƒ½æ˜¯å‡½æ•°ç»„ä»¶ï¼Œä½†æ˜¯ MDX åŸç”Ÿçš„å¦‚ **h1** ä¸ºå­—ç¬¦ä¸²ï¼Œåœ¨å¼€å¯ **jsx=false** æ—¶ï¼Œç¼–è¯‘å‡ºçš„å‡½æ•°ä¼šå…¼å®¹å­—ç¬¦ä¸²å½¢å¼ï¼Œä½†æ˜¯åˆä¸ä¸Šä¸€ä¸ªé—®é¢˜çš„è§£å†³æ–¹æ³•çŸ›ç›¾äº†

å› æ­¤æœ‰ä¸¤ç§å…¶ä»–è§£å†³æ–¹æ³•
1. åœ¨è°ƒç”¨ `new Function()` å¾—åˆ° Component åï¼Œä¼ å…¥ **components**ï¼Œå°† h1 è¿™äº›å­—ç¬¦ä¸²æ ‡ç­¾æ”¹å†™ä¸ºå‡½æ•°ç»„ä»¶
2. å¢åŠ  babel æ’ä»¶å°†ä¹‹å‰ç¼–è¯‘å¾—åˆ°çš„ `_components` å¯¹è±¡æ”¹å†™

æœ€åç¢äºæ—¶é—´çš„å…³ç³»ï¼Œé‡‡ç”¨äº†ç¬¬ä¸€ç§æ–¹æ³•

```tsx title="mdx-component.tsx" {2,12}
const components = {
  a: (props: any) => <a {...props}>{props?.children}</a>,
  // ...
}

const MDXComponent = (props: MDXComponentProps) => {
  const component = createMemo(() => {
    if (props.mdx) {
      // ... ...
      const fn = new Function(...Object.keys(scope), code)
      const Comp = fn(...Object.values(scope))?.default
      return () => <Comp components={components} />
    }
    return undefined
  })
  return <Dynamic component={component()} />
}
```

#### ç»™ MDX å¢åŠ å…¶ä»–ä¿¡æ¯
åœ¨ä½¿ç”¨ rollup æ‰“åŒ…è¾“å‡º json çš„æ—¶å€™è¿˜å¸Œæœ›åŒ…å«ä¸€äº›é¢å¤–çš„ä¿¡æ¯ï¼Œå¦‚ tocï¼Œè¿™ä¸ªå¯ä»¥æ”¾åœ¨ **transform** çš„é˜¶æ®µå»åšï¼Œå°†ä¿¡æ¯æ³¨å…¥ meta é‡Œï¼Œç„¶ååœ¨ **renderChunk** çš„æ—¶å€™ä¸€å¹¶æ‹¿å‡ºæ¥ï¼Œå…·ä½“åšæ³•å‚è€ƒäº† [shadcn-ui](https://github.com/shadcn-ui/ui) ç”Ÿæˆ TOC çš„åšæ³•

```ts title="inject-mdx-data.ts" {8-9, 12}
async transform(code, id) {
  if (/.(mdx|md)$/.test(id)) {
    const result = await unified()
      // ...

    const contentData = {
      raw: code,
      toc: result.data?.toc,
      matter: result.data?.matter,
    }

    return { meta: { contentData } }
  }
},
```

## éƒ¨ç½²
å…³äºéƒ¨ç½²æ¯”è¾ƒç®€å•ï¼ŒNitro æä¾›äº†å¼€ç®±å³ç”¨çš„é…ç½®ï¼Œæˆ‘é€‰æ‹©äº† **vercel** ä½œä¸ºéƒ¨ç½²å¹³å°ï¼Œå› æ­¤åªéœ€è¦å¢åŠ ä¸€ä¸ª presets é…ç½®å³å¯

```ts title="vite.config.ts" {4}
export default defineConfig({
  start: {
    server: {
      preset: 'vercel',
      prerender: {
        routes: ['/example', '/docs/getting-started'],
      },
    },
    extensions: ['mdx', 'md'],
  },
  // ... ...
})
```